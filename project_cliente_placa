import os
archivo=open('registro_placa.txt','w')
histrorial_cliente={}
mantenimieto={'preventivo':[('BLOQUE DE CILINDROS',73,79),('PIPA RESONANTE',53,89),('INTERRUPTOR DE ENCENDIDO',63,99), ('MOTOR',50,50)],
'correctivo':[('TRANSMISION CORREA',43,79),('PIÑÓN',23,79),('DEPOSITO DE EXPANSION',83,79), ('LLANTAS',120,120)]}
os.system('cls')#dar color a las letras



def menu_mantenimiento():
    mostrar_consola("menu mantenimiento")
    while True:
        try:
            eleccion_mant=int(input("                                    \u001b[33mINGRESE EL NÚMERO DE LA OPCIÓN=\u001b[37m "))
            print()
            mostrar_consola('raya')
        except:
            continue
        opcion_manteniminto(eleccion_mant)
    


def opcion_manteniminto(eleccion_mant):
    if eleccion_mant ==1:
        registro_mantenimiento('preventivo','PREVENTIVO')
    if eleccion_mant ==2:
        registro_mantenimiento('correctivo','CORRECTIVO')
    if eleccion_mant ==3:
        menu_principal()



def registro_mantenimiento(clave,tx):
    mostrar_consola(tx)
    parte_auto_mant=str(input("                                    \u001b[33mINGRESE LA PARTE DEL VEHÍCULO=\u001b[37m "))
    parte_auto_mant=parte_auto_mant.upper()
    while True:
        os.system('cls')
        mostrar_consola(tx)
        print(f"                                     \u001b[33mINGRESE LA PARTE DEL VEHÍCULO=\u001b[37m {parte_auto_mant}")
        try:
            dias_mant=int(input("                                     \u001b[33mINGRESE LOS DÍAS=\u001b[37m "))
            kilometro_mant=int(input("                                     \u001b[33mINGRESE EL ÚLTIMO KILOMETRAJE=\u001b[37m "))
        except:
            continue
        remplazar_repeti_mante(parte_auto_mant,clave)
        mantenimieto[clave].append((parte_auto_mant,dias_mant,kilometro_mant))
        menu_mantenimiento()
   


def remplazar_repeti_mante(parte,clave):
    for i in range(len(mantenimieto[clave])):
        if parte in mantenimieto[clave][i]:
           mantenimieto[clave].pop(i)
           mantenimieto[clave].append('#')
           mantenimieto[clave].remove('#')    
    
    

def menu_principal():
    while True:
        mostrar_consola('menu principal')
        try:
            opcion_menu_prin=int(input("                                    \u001b[32mINGRESE EL NÚMERO DE LA OPCIÓN=\u001b[37m "))
            print()
        except:
            continue
        eleccion_menu_principal(opcion_menu_prin,histrorial_cliente)



def eleccion_menu_principal(opcion_menu_prin,historial_cli):
    if opcion_menu_prin==1:
        menu_mantenimiento()
    if opcion_menu_prin==2:
        crear_placa(historial_cli)
    if opcion_menu_prin==3:
        buscar('placa','MANTENIMIENTO POR PLACA')
    if opcion_menu_prin==4:
        buscar('parte de vehiculo','RECOMENDACIÓN POR PARTES')
    if opcion_menu_prin==5:
        os.system('cls')
        mostrar_consola('raya')
        print()
        print("                                                    \u001b[31;1mSALIO\u001b[37m")
        print()
        mostrar_consola('raya')
        exit()



def crear_placa(historial_cli):
    os.system('cls')
    mostrar_consola("CARGANDO INFORMACIÓN DEL HISTORIAL...")
    print()
    cliente={'propietario':str,'registro':[]}
    placa=str(input("                                    \u001b[33mINGRESE LA PLACA=\u001b[37m "))
    placa=placa.upper()
    placa_repetida(placa)
    propietario=str(input("                                    \u001b[33mINGRESE SU NOMBRE Y APELLIDO=\u001b[37m "))
    propietario=propietario.upper()
    cliente['propietario']=propietario
    historial_cli[placa]=cliente
    registro_parte_placa(historial_cli,placa)



def placa_repetida(placa_cli):
    if placa_cli in histrorial_cliente:
        print("                                    ESTA PLACA YA EXISTE!!")
        print()
        crear_placa(histrorial_cliente)


    
def registro_parte_placa(historial_cli,placa):
    parte_auto_cli=str(input("                                    \u001b[33mINGRESE LA PARTE DEL VEHÍCULO=\u001b[37m "))
    print()
    parte_auto_cli=parte_auto_cli.upper()
    while True:
        os.system('cls')
        mostrar_consola("CARGANDO INFORMACIÓN DEL HISTORIAL...")
        print()
        print(f"                                    \u001b[33mINGRESE LA PLACA=\u001b[37m {placa}")
        print(f"                                    \u001b[33mINGRESE SU NOMBRE Y APELLIDO=\u001b[37m {histrorial_cliente[placa]['propietario']}")
        print(f"                                    \u001b[33mINGRESE LA PARTE DEL VEHÍCULO=\u001b[37m {parte_auto_cli}")
        try:
            dias_cli=int(input("                                    \u001b[33mINGRESE LOS DÍAS=\u001b[37m "))
            kilometro_cli=int(input("                                    \u001b[33mINGRESE EL ÚLTIMO KILOMETRAJE=\u001b[37m "))
            print()
        except:
            continue
        remplazar_repetida_parte_registro_placa(placa,parte_auto_cli)
        historial_cli[placa]['registro'].append((parte_auto_cli,dias_cli,kilometro_cli))
        seguir_agregando_parte_placa(historial_cli,placa)



def remplazar_repetida_parte_registro_placa(placa,parte_cli):
    for i in range(len(histrorial_cliente[placa]['registro'])):
        if parte_cli in histrorial_cliente[placa]['registro'][i][0]:
            histrorial_cliente[placa]['registro'].pop(i)
            histrorial_cliente[placa]['registro'].append('#')
            histrorial_cliente[placa]['registro'].remove('#')



def seguir_agregando_parte_placa(historial_cli,placa):
    print()
    while True:
        try:
            mostrar_consola('raya')
            si_no_agregar_histo=int(input("                                    \u001b[32mDESEA AGREGAR UNA PARTE MAS 1 ES SI Y 2 ES NO=\u001b[37m"))
            print()
            mostrar_consola('raya')
        except:
            print()
            continue
        if si_no_agregar_histo ==1:
            registro_parte_placa(historial_cli,placa)
        if si_no_agregar_histo ==2:
            guardar_archivo(placa)
            menu_principal()



def buscar(palabra,tx):
    os.system('cls')
    mostrar_consola(tx)
    parte_or_placa = str(input(f"                                    \u001b[33mINGRESE LA {palabra}:\u001b[37m "))
    parte_or_placa = parte_or_placa.upper()
    if palabra==str("placa"):
        mostrar_consola("placa")
        buscar_placa(parte_or_placa)
    if palabra==str("parte de vehiculo"):
        mostrar_consola("parte")
        buscar_parte(parte_or_placa)
    print()
    while True:
        try:
            continuar_menu=int(input("INGRESE UN NUMERO PARA CONTINUAR= "))
        except:
            continue
        if continuar_menu==continuar_menu:
            menu_principal()
        


def buscar_placa(buscar_placa):
    if buscar_placa in histrorial_cliente:
        for regist,pre,cor in [(regist,pre,cor)for regist in range(len(histrorial_cliente[buscar_placa]['registro']))for pre in range(len(mantenimieto['preventivo']))for cor in range(len(mantenimieto['correctivo']))]:  
            consola_placa=str(f"                   {buscar_placa}              {histrorial_cliente[buscar_placa]['registro'][regist][0]}")
            if (histrorial_cliente[buscar_placa]['registro'][regist][0] in mantenimieto['preventivo'][pre][0]) or (histrorial_cliente[buscar_placa]['registro'][regist][0] in mantenimieto['correctivo'][cor][0]):
                comparar_km(buscar_placa,consola_placa,regist,pre,cor)
    else:
        print("                                                           NO EXISTE LA PLACA!!") 



def buscar_parte(parte_vehiculo):
    for plac0 in histrorial_cliente:
        for regist0 in range(len(histrorial_cliente[plac0]['registro'])):
            if parte_vehiculo in histrorial_cliente[plac0]['registro'][regist0]:
                consola_parte=str(f"                {parte_vehiculo}                    {plac0}  ")
                for pre,cor in [(pre,cor)for pre in range(len(mantenimieto['preventivo']))for cor in range(len(mantenimieto['correctivo']))]:
                    if (histrorial_cliente[plac0]['registro'][regist0][0] in mantenimieto['preventivo'][pre][0]) or (histrorial_cliente[plac0]['registro'][regist0][0] in mantenimieto['correctivo'][cor][0]):
                        comparar_km(plac0,consola_parte,regist0,pre,cor)



def comparar_km(parte_or_placa,consola,regist,pre,cor):
    if pre==pre and cor==pre:
        for _l in range(1):
            if (histrorial_cliente[parte_or_placa]['registro'][regist][2] > mantenimieto['preventivo'][pre][2]) and (histrorial_cliente[parte_or_placa]['registro'][regist][2] >= mantenimieto['correctivo'][cor][2]) or (None == mantenimieto['preventivo'][pre][2]) and (histrorial_cliente[parte_or_placa]['registro'][regist][2] >= mantenimieto['correctivo'][cor][2]):
                print(f"                         {consola}            CORRECTIVO     ")
            elif (histrorial_cliente[parte_or_placa]['registro'][regist][2] >= mantenimieto['preventivo'][pre][2]) and ( None == mantenimieto['correctivo'][cor][2]) or (histrorial_cliente[parte_or_placa]['registro'][regist][2] >= mantenimieto['preventivo'][pre][2]) and (histrorial_cliente[parte_or_placa]['registro'][regist][2] < mantenimieto['correctivo'][cor][2]):
                print(f"                         {consola}            PREVENTIVO     ")
            else:
                print(f"                         {consola}            NINGUNA        ")



def mostrar_consola(tx):  
    if tx=="CARGANDO INFORMACIÓN DEL HISTORIAL...":
        os.system('cls') 
        print()
        print() 
        print("                                  _____________________________________________________________")
        print("                                  |                                                           |")
        print(f"                                  |              {tx}        |")
        print("                                  |___________________________________________________________|")
        print()
        print("\u001b[37m========================================================================================================================\u001b[37m")
    if tx=="PREVENTIVO" or tx=="CORRECTIVO":
        os.system('cls')
        print()
        print()
        print("                                     ___________________________________")
        print("                                     |                                 |")
        print(f"                                     |            {tx}           |")
        print("                                     |_________________________________|")
        print()
        print("\u001b[37m========================================================================================================================\u001b[37m")
    if tx=="RECOMENDACIÓN POR PARTES":
        os.system('cls')
        print()
        print()
        print("                                     _______________________________________________")
        print("                                     |                                              |")
        print(f"                                     |           {tx}           |")
        print("                                     |______________________________________________|")
        print()
        print("\u001b[37m========================================================================================================================\u001b[37m")
    if tx=="MANTENIMIENTO POR PLACA":
        os.system('cls')
        print()
        print()
        print("                                     _______________________________________________")
        print("                                     |                                              |")
        print(f"                                     |           {tx}            |")
        print("                                     |______________________________________________|")
        print()
        print("\u001b[37m========================================================================================================================\u001b[37m")
    if tx=="menu principal":
        os.system('cls')
        print("                   ______________________________________________________________________")
        print("                   |                                                                    |")
        print("                   |                     MANTENIMIENTO DE VEHICULOS                     |")
        print("                   |____________________________________________________________________|")
        print("                   |                                                                    |")
        print("                   |  1: Cargar información a tabla de mantenimiento                    |")
        print("                   |  2: Cargar información del historial de vehículos desde un archivo |")
        print("                   |  3: Mantenimiento por Placa                                        |")
        print("                   |  4: Recomendación por Partes                                       |") 
        print("                   |  5: Salir                                                          |")
        print("                   |____________________________________________________________________|")
        print()
        print("\u001b[37m========================================================================================================================\u001b[37m")
    if tx=="menu mantenimiento":
        os.system('cls')
        print()
        print()
        print("                                  ______________________________________________________")
        print("                                  |                                                    |")
        print("                                  |         QUE TIPO DE MANTENIMIENTO QUIERE?          |")
        print("                                  |____________________________________________________|")
        print("                                  |                                                    |")
        print("                                  |                  1: PREVENTIVO                     |")
        print("                                  |                  2: CORRECTIVO                     |")
        print("                                  |                  3: SALIR                          |")
        print("                                  |____________________________________________________|")
        print()
        print("\u001b[37m========================================================================================================================\u001b[37m")
    if tx=="raya":
        print("\u001b[37m========================================================================================================================\u001b[37m")
    if tx=="placa":
        print("                                    ________________________________________________________________")
        print("                                   |    \u001b[33mPLACA\u001b[37m           |          \u001b[33mPARTE\u001b[37m         |   \u001b[33mTIPO MANT\u001b[37m      |")
        print("                                   |____________________|________________________|__________________|")    
        print()
    if tx=="parte":
        print("                                    ________________________________________________________________")
        print("                                   |    \u001b[33mPARTE\u001b[37m           |          \u001b[33mPLACA\u001b[37m         |   \u001b[33mTIPO MANT\u001b[37m      |")
        print("                                   |____________________|________________________|__________________|")    
        print()    


def guardar_archivo(placa):
    archivo.write(f"\n placa= {placa}")
    archivo.write(f"\n      nombre/apellido= {histrorial_cliente[placa]['propietario']}")
    archivo.write(f"\n      (parte/dia/km)= {histrorial_cliente[placa]['registro']}")     



while True:
    menu_principal()
  
